# DishmanCMS *v.2.31.1*

## Основная информация

### Варианты запуска
- 1 OpenServer
- 2 Docker через docker-compose.yml в корне проекта (Инструкция будет позже)

### Минимальная совместимость
- 1 Версия Yii1 не ниже 1.17
- 2 Версия php не ниже 7.2
- 3 Версия MySql не ниже 5.7

## Запуск приложения
### Не зависимо от платформы запуска:

<ul>
   <li>Установить git</li>
   <li>Создать директорию yii с фреймворком Yii1 внутри на одном уровне с директорией проекта
      <ul>
         <li><a href="https://github.com/yiisoft/yii/releases/download/1.1.27/yii-1.1.27.8f9404.tar.gz">Архив фреймворка</a>
             - перенести содержимое директории framework в созданную ранее директорию yii</li>
      </ul>
   </li>
   ИЛИ
   <li>Установить зависимости из корневой директории приложения(composer install)</li>
</ul>

### OpenServer
1. **В настройках OpenServer вкладка Модули**
   - 1.2. HTTP - выбрать Apache_2.4-PHP_7.2-7.4
   - 1.3. PHP - выбрать от 7.2 до 7.4
   - 1.4. MySQL / MariaDB - выбрать MySQL-5.7
   <hr>
2. **Запустить OpenServer**
   <hr>
3. **В PhpMyAdmin**
   - (ПКМ на флажек, Дополнительно -> PhpMyAdmin), стандартные логин и пароль root root или только логин без пароля
   - 3.1. Создать базу данных (2 варианта по картинкам)
   - 3.2. Запрос "CREATE DATABASE db_name" изменить название базы на нужное и выполнить его
       ![SQL запросом](images/instruction/os_db_creating.png "phpmyadmin")
       ИЛИ
       ![Кнопки](images/instruction/os_db_creating_1.png "phpmyadmin")
      <hr>
4. **В директории OpenServer/domains/**
    - 4.1. Клонировать dishcms с github
      (ПКМ на флажек OpenServer, Дополнительно -> Консоль)
      - 4.1.1. Перейти в domains если еще не в ней(команда "cd domains", чтобы получилось примерно C:\OpenServer\domains)
      - 4.1.2. Команда "git clone https://github.com/KONTUR-Novosibirsk/dishcms.git"
    - 4.2. Создать директорию с префиксом local. или постфиксом .local и в ней инициализировать гит проект
    - 4.3. Перенести в неё все файлы из dishcms исключая папки .git и .idea (если они есть)
    <hr>
5. **В директории проекта**
    - 5.1. В директории protected/config создать файл local.db.php, можно скопировать в него код из db.php или написать свой
      - В строке 'connectionString' в dbname=new-grid заменить new-grid на название ранее созданной базы
      - username по дефолту root
      - password по дефолту root или без пароля(оставить пустое '')
    - 5.2 Применить миграции
      - 5.2.1. Из консоли перейти в директорию protected и выполнить команду "php yiic.php migrate"
      <br> так же возможен вариант с автоматическим применением миграций при первом запуске приложения в браузере, но тогда возможно появление неявных ошибок позднее,
      наличие файла protected/runtime/.installed означает что миграции уже применились

